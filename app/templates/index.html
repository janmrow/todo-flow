<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>One-Line To-Do</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <main class="container py-5" style="max-width: 680px;">
    <div class="d-flex align-items-baseline justify-content-between mb-3">
      <h1 class="h3 m-0">One-Line To-Do</h1>
      <span class="text-muted small">Flask + SQLite</span>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-3">
          {% for category, message in messages %}
            {% if category == "error" %}
              <div class="alert alert-danger py-2 mb-2">{{ message }}</div>
            {% else %}
              <div class="alert alert-success py-2 mb-2">{{ message }}</div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form class="card card-body mb-3" method="post" action="{{ url_for('ui.add_task', filter=filter_name) }}">
      <div class="input-group">
        <input class="form-control" name="text" placeholder="Add a task and press Enter…" autofocus>
        <button class="btn btn-primary" type="submit">Add</button>
      </div>
      <div class="form-text">Keep it short. Toggle done when you finish.</div>
    </form>

    <ul class="nav nav-pills mb-3">
      {% set tabs = [("all", "All"), ("active", "Active"), ("done", "Done"), ("archived", "Archived")] %}
      {% for key, label in tabs %}
        <li class="nav-item">
          <a class="nav-link {% if filter_name == key %}active{% endif %}"
             href="{{ url_for('ui.index', filter=key) }}">{{ label }}</a>
        </li>
      {% endfor %}
    </ul>

    <div class="card">
      <div class="card-body">
        {% if tasks %}
          <ul class="list-group list-group-flush">
            {% for t in tasks %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="me-3">
                  <div class="fw-semibold">{{ t.text }}</div>
                  <div class="text-muted small">#{{ t.id }} • {{ t.created_at }}</div>
                </div>

                <div class="d-flex align-items-center gap-2">
                  {% if t.done %}
                    <span class="badge text-bg-success">done</span>
                  {% else %}
                    <span class="badge text-bg-secondary">todo</span>
                  {% endif %}

                  {% if filter_name != "archived" %}
                    <form method="post" action="{{ url_for('ui.toggle_task', task_id=t.id, filter=filter_name) }}" class="m-0">
                      {% if t.done %}
                        <button class="btn btn-sm btn-outline-secondary" type="submit">Undo</button>
                      {% else %}
                        <button class="btn btn-sm btn-outline-primary" type="submit">Done</button>
                      {% endif %}
                    </form>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted m-0">No tasks yet. Add one above.</p>
        {% endif %}
      </div>
    </div>
  </main>
</body>
</html>
